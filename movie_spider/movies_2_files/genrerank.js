$(function(){var t=-1;$.ajax({url:dataSrc,data:{type:movieType,interval_id:interval,action:"",start:start,limit:1},type:"GET",success:function(e){e&&e.length>0&&(t=e[0].rank)},error:function(t){}}),$.renderDataCount(dataCountSrc,{type:movieType,interval_id:interval}),$.renderData(dataSrc,{type:movieType,interval_id:interval,action:action,start:start,limit:limit},!0),window.onmousewheel=document.onmousewheel=document.onscroll=function(){if(t>0){var e=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,a=$(".movie-list-panel:visible").children(),i=a.last().offset().top-screen.height;isIE||(i+=a.last().height()),($(".movie-list-panel:visible").hasClass("list")&&isIE&&e>=30||e>=i)&&$.renderData(dataSrc,{type:movieType,interval_id:interval,action:action,start:a.last().find(".movie-content .rank-num").text()-t+1,limit:limit},!1);var o=$(".backtotop");if(e>$(".option-panel").offset().top&&!o.is(":visible"))o.fadeIn(100),$("#placeHolder").css("height","181px"),$(".operator-panel").addClass("operator-panel-hover").css({top:"-400px"}),$(".operator-panel").animate({top:0},160);else{if(!(e<=$(".option-panel").offset().top&&o.is(":visible")))return;o.hide(),$(".operator-panel").removeClass("operator-panel-hover"),$("#placeHolder").css("height","0")}}else $.ajax({url:dataSrc,data:{type:movieType,interval_id:interval,action:"",start:start,limit:1},type:"GET",success:function(e){e&&e.length>0&&(t=e[0].rank)},error:function(t){}})},$(".backtotop").click(function(){$(".operator-panel").removeClass("operator-panel-hover"),isIE?(document.documentElement.scrollTop=0,$(this).fadeOut()):navigator.userAgent.toLowerCase().indexOf("firefox")>=0?(document.documentElement.scrollTop=0,$("body").scrollTop(0)):$("body").scrollTop(0)}),$(".moretype").click(function(){$(".types").is(":visible")?($(".types").slideUp(),$(this).find("span").removeClass("rotate")):($(".types").slideDown(),$(this).find("span").addClass("rotate"))}),$(document).click(function(t){!$(".types").is(":visible")||$(t.target).hasClass("types")||$(t.target).parent().hasClass("types")||$(t.target).hasClass("moretype")||$(t.target).parent().hasClass("moretype")||($(".types").slideUp(),$(".moretype span").removeClass("rotate"))}),$(".operator-rating").html(interval.split(":").join("%-")+"%");var e=$("#spot"+interval.split(":")[0]);$(".cursor").css("left",e.offset().left-$("#opr").offset().left+"px"),e.tooltipShow().next().next().tooltipShow(),e.attr("class")!=$(".cursor").children().first().attr("class")&&$.adjustCursor(),$("#spot100, #spot50, #spot0").each(function(){$(this).scaleMark()}),$(".bar .bigspot, .bar .smallspot").mouseenter(function(){var t=$(this);document.getElementById("ttip"+t.attr("perc"))||t.attr("id")==clickedSpot||t.tooltipShow()}).mouseout(function(){var t=$(this);t.attr("id")!=clickedSpot&&t.tooltipHide()}).mousedown(function(){clickedSpot=$(this).attr("id"),$(".bar").children().each(function(){$(this).tooltipHide()})}).click(function(e){var a=$(".cursor"),i=$(this);clickedSpot=i.attr("id"),i.index()>splitsNum-1?i=$(".bar .bigspot").eq(9):i.offset().left>a.offset().left&&(i=i.prev().prev());var o=parseInt(i.attr("perc"))-10,n=parseInt(i.attr("perc"));interval=n+":"+o,navigator.userAgent.toLowerCase().indexOf("msie 7.0")<0&&history.pushState({},"","typerank?type_name="+movieTypeName+"&type="+movieType+"&interval_id="+interval+"&action="+action),t=$(".movie-list-panel:visible").find(".movie-list-item").first().find(".rank-num").text(),$.ajax({url:dataSrc,data:{type:movieType,interval_id:interval,action:"",start:start,limit:1},type:"GET",success:function(e){e&&e.length>0&&(t=e[0].rank)},error:function(t){}}),$.renderDataCount(dataCountSrc,{type:movieType,interval_id:interval}),$.renderData(dataSrc,{type:movieType,interval_id:interval,action:action,start:start,limit:limit},!0),$(".operator-rating").html(n+"%-"+o+"%"),"10"==i.attr("perc")?$(".operator-note").fadeIn():$(".operator-note").fadeOut(),a.animate({left:i.offset().left-$("#opr").offset().left+"px"},400,function(){i.tooltipShow().next().next().tooltipShow()}),i.attr("class")!=a.children().first().attr("class")&&$.adjustCursor()}),$(".cursor").mousedown(function(t){var e=this,a=$("#opr"),i=$.layerX(t)-$(e).offset().left+$(t.target||t.srcElement).offset().left,o=a.width(),n=a.offset().left;document.onmousemove=function(t){$(".bar").children().each(function(){$(this).tooltipHide()}),$.capture(e);var a=$.pageX(t)-i-n;a>=0&&a<=o-$(e).width()&&(e.style.left=a+"px")},document.onmouseup=function(){$.capture(e),document.onmousemove=null,document.onmouseup=null;var t=$(e).offset().left-n,a=o/splitsNum,i=100-5*(t/a-parseInt(t/a)>=.5?parseInt(t/a)+1:parseInt(t/a)),r=$("#spot"+i);10==i?$(".operator-note").fadeIn():$(".operator-note").fadeOut(),interval=i+":"+(i-10),navigator.userAgent.toLowerCase().indexOf("msie 7.0")<0&&history.pushState({},"","typerank?type_name="+movieTypeName+"&type="+movieType+"&interval_id="+interval+"&action="+action),$.renderDataCount(dataCountSrc,{type:movieType,interval_id:interval}),$.renderData(dataSrc,{type:movieType,interval_id:interval,action:action,start:start,limit:limit},!0),$(".operator-rating").html(i+"%-"+(i-10)+"%"),document.getElementById("ttip"+i)||(r.tooltipShow().siblings().each(function(){$(this).tooltipHide()}),r.next().next().tooltipShow(),r.attr("class")!=$(e).children().first().attr("class")&&$.adjustCursor()),$(e).animate({left:r.offset().left-n},160)}}),action&&action.length>0&&(action.indexOf("unwatched")>=0&&$("#chkUnwatched").attr("checked","checked"),action.indexOf("playable")>=0&&$("#chkPlayable").attr("checked","checked")),$(".viewMode").change(function(){switch($(this).val()){case"list":$(".list").fadeIn(),$(".pictext").fadeOut();break;case"pictext":$(".pictext").fadeIn().find(".movie-img").lazyload(),$(".list").fadeOut()}}),$(".filter").change(function(){var t=$(this);switch(t.val()){case"isunwatched":"checked"==t.attr("checked")?action.length>0?action+="+unwatched":action="unwatched":action.indexOf("+")>0?action="playable":action="";break;case"isplayable":"checked"==t.attr("checked")?action.length>0?action+="+playable":action="playable":action.indexOf("+")>0?action="unwatched":action=""}$.renderData(dataSrc,{type:movieType,interval_id:interval,action:action,start:start,limit:limit},!0),history.pushState({},"","typerank?type_name="+movieTypeName+"&type="+movieType+"&interval_id="+interval+"&action="+action)})});